$(document).ready(function(){var e=$('meta[name="csrf-token"]').attr("content");function t(e,t=""){$(e).block({css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"},message:t})}function a(e){$(e).unblock()}_target=null,$("#media-model").on("show.bs.modal",function(e){var t=$(e.relatedTarget);t.data("images"),t.data("single")}),$("body").on("click",".media-selector",function(){var e=$(this).attr("data-images");n.$data.selected_ids=e,n.$data.next_page=1,n.$data.complet=!1,n.fetchSelected(e)});var i=new Vue({el:"#media-setting",data:{categories:[],new_cat:"",edit:!1,update_cat_name:null,update_cat_id:null},created(){},methods:{fetchCats(){this.categories;$.ajax({url:"./media-manager/cat/fetch",success:function(e){e=jQuery.parseJSON(e),this.categories=e.cats,e.cats}.bind(this)})},enableUpdateCat(e){t("#cats-table"),this.update_cat_name=e.name,this.update_cat_id=e.id,this.edit=!0},updateCat(){t("#update-cat"),$.ajax({url:"./media-manager/cat/update/"+this.update_cat_id,method:"POST",data:{name:this.update_cat_name,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){"ok"===(e=jQuery.parseJSON(e)).status?this.categories=e.cats:alert("something went wrong")}.bind(this)}),this.edit=!1,a("#cats-table"),a("#update-cat")},addCat(){t("#new-cat",media_trans.please_wait);this.categories;$.ajax({url:"./media-manager/cat/add",method:"POST",data:{name:this.new_cat,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){"ok"===(e=jQuery.parseJSON(e)).status?this.categories.unshift(e.cat):alert("something went wrong"),a("#new-cat")}.bind(this)}),this.new_cat=""},cancleEdit(){this.update_cat=null,a("#cats-table"),this.edit=!1},deleteCat(e){t("#cats-table",media_trans.processing+" ..."),$.ajax({url:"./media-manager/cat/delete/"+e.id,success:function(t){if("ok"===(t=jQuery.parseJSON(t)).status)for(var i=0;i<this.categories.length;i++)this.categories[i].id===e.id&&this.categories.splice(i,1);else alert("Something went wrong !");a("#cats-table")}.bind(this)})}}}),s=new Vue({el:"#media-uploader",data:{categories:[],cat_id:"",image:null,alt:"",temp_image:null,done_image:null,image_name:null,target_cat:null,image_status:null},created(){$(document).on("show.bs.modal","#media-model",function(e){var t=$(e.relatedTarget);this.target_cat=t.data("cat")}.bind(this))},methods:{fetchCats(){this.categories;$.ajax({url:"./media-manager/cat/fetch",success:function(e){e=jQuery.parseJSON(e),this.categories=e.cats,e.cats,n.$data.categories=e.cats}.bind(this)})},done(){t("#upload-result",media_trans.please_wait+" ...");var e=null!==this.target_cat?this.target_cat:this.cat_id;$.ajax({url:"./media-manager/images/done",method:"POST",data:{alt:this.alt,cat_id:e,name:this.image_name,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){"ok"===(e=jQuery.parseJSON(e)).message&&(this.image_status="done",this.done_image=e.data,n.$data.images.unshift(this.done_image)),a("#upload-result")}.bind(this),fial:function(){alert("somthing went wrong"),a("#upload-result")}})},upload(){if(""===this.alt)return alert("please enter Image alt"),!1;if(null===this.image)return alert("please choose Image"),!1;t("#media-uploader",media_trans.uploading+" ...");var e=new FormData;e.append("image",this.image),e.append("alt",this.alt),null!==this.target_cat?e.append("cat_id",this.target_cat):e.append("cat_id",this.cat_id),e.append("_token",$('meta[name="csrf-token"]').attr("content")),$.ajax({url:"./media-manager/images/upload",cache:!1,contentType:!1,processData:!1,method:"POST",data:e,success:function(e){"ok"===(e=jQuery.parseJSON(e)).message?(this.temp_image=e.data,this.image_name=e.data.name,this.image_status="temp",t("#upload_form",media_trans.upload_complete+" , "+media_trans.check_image_below)):"exist"===e.message?(this.done_image=e.data,this.image_name=e.data.name,this.image_status="done"):alert("something Went Wrong"),a("#media-uploader")}.bind(this),fial:function(){alert("something Went Wrong"),a("#media-uploader")}})},processFile(e){this.image=e.target.files[0]},resetUploadForm(){this.image=null,this.alt="",this.cat_id=""},cancleTemp(){this.image=null,this.temp_image=null,this.image_status=null,this.image_name=null,this.resetUploadForm(),a("#upload_form")},okImage(){$("#images-tab").trigger("click"),this.cancleTemp()},okNew(){this.cancleTemp()}}}),n=new Vue({el:"#media-images",data:{images:[],selected_images:[],selected_ids:null,single_image:!1,cat_id:"",target_cat:null,alt:"",next_page:1,complet:!1,target:null,categories:[],loading:!0,name:""},created(){$(document).on("show.bs.modal","#media-model",function(e){var t=$(e.relatedTarget);this.target=t,this.target_cat=t.data("cat"),this.single_image=t.data("single"),this.name=t.data("name"),this.images=[],this.target_cat||this.fetchCats(),console.log(this.next_page),this.next_page=1,this.fetchImages()}.bind(this))},methods:{fetchCats(){this.categories;$.ajax({url:"./media-manager/cat/fetch",success:function(e){e=jQuery.parseJSON(e),this.categories=e.cats,e.cats,s.$data.categories=e.cats,i.$data.categories=e.cats}.bind(this)})},fetchImages(){1==this.next_page&&(this.loading=!0);var e=this.target_cat?this.target_cat:this.cat_id;$.ajax({url:"./media-manager/images/get",data:{cat_id:e,alt:this.alt,page:this.next_page,ids:this.selected_ids},success:function(e){"ok"===(e=jQuery.parseJSON(e)).message&&(1===this.next_page?this.images=e.data.data:this.images=this.images.concat(e.data.data),e.data.last_page>this.next_page?this.next_page++:this.complet=!0),this.loading=!1}.bind(this),fail:function(){alert("something went wrong"),this.loading=!1}})},scrollLoad(e){if(e.target.scrollHeight-e.target.scrollTop===e.target.clientHeight){if(this.complet)return!1;this.fetchImages()}},fetchSelected(t){$.ajax({url:"./media-manager/images/get-by-ids",method:"POST",data:{_token:e,ids:t},success:function(e){"ok"===(e=jQuery.parseJSON(e)).message&&(this.selected_images=e.data)}.bind(this)})},selectImage(e){if(this.in_arr(this.selected_images,e)){var t=this.get_index(this.selected_images,e);t>-1&&this.selected_images.splice(t,1)}else this.single_image?this.selected_images=[e]:this.selected_images.push(e);$("#sortable").sortable({axis:"y",stop:function(e,t){var a=$("#sortable").sortable("refreshPositions").children();$.each(a,function(){})}.bind(this)});$("#sortable").disableSelection()},removeImage(e){var t=this.selected_images.indexOf(e);this.selected_images.splice(t,1)},copy(){var e;e="image_url",document.getElementById(e).select(),document.execCommand("copy"),alert("Copied the URL !")},deleteImage(i){$.ajax({url:"./media-manager/images/delete",method:"POST",data:{image_id:i.id,_token:e},beforeSend:function(e){t("#media-model")},success:function(e){if("ok"===(e=jQuery.parseJSON(e)).message){var t=this.images.indexOf(i);this.images.splice(t,1),this.removeImage(i)}a("#media-model")}.bind(this).bind(i),fail:function(){alert("something went wrong !"),a("#media-model")},always:function(){a("#media-model")}})},save(){t("#media-model");var e=this.target,i=this.name;e.closest("div.media-manager-group").find(".result").html(""),$("#sortable").find(".on-img").each(function(){var t=$(this).attr("src"),a=$(this).attr("data-id"),s="<img src='"+t+"' class='media-image on-image' ><input type='hidden' name='"+i+"' value='"+a+"'/>";e.closest("div.media-manager-group").find(".result").append(s)});for(var s=[],n=0;n<this.selected_images.length;n++)s.push(this.selected_images[n].id);e.attr("data-images",s),$("#media-model").modal("toggle"),a("#media-model")},in_arr(e,t){for(var a=0;a<=e.length;a++)if(JSON.stringify(t)===JSON.stringify(e[a]))return!0;return!1},get_index(e,t){for(var a=0;a<=e.length;a++)if(JSON.stringify(t)===JSON.stringify(e[a]))return a;return-1},resetSearch(){this.cat_id="",this.alt="",this.fetchImages()},search(){this.next_page=1,this.fetchImages()}}});$(".sfu").change(function(){console.log(this);var e=$(this).prop("files")[0],t=new FormData;t.append("image",e),$(this).next("img.img-loading").show(),$(this).prev("label").hide();$(this);var a=$(this).data("target");console.log("#"+a),a=$("#"+a),$.ajax({url:"./media-manager/images/upload",dataType:"text",cache:!1,contentType:!1,processData:!1,data:t,type:"post",success:function(e){var t=jQuery.parseJSON(e);200==t.status?(a.find("img.img-loading").hide(),a.find("label").show(),a.find("input.image-val").val(t.data.name),a.find("img.img-preview").attr("src",t.data.path+"/"+t.data.name).show()):(alert(t.message),a.find("img.img-loading").hide(),a.find("label").show())},error:function(){alert("something went wrong")}})})});